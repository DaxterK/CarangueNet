<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>FakeNet Carangueju</title>
<style>
body, html {margin:0; padding:0; font-family:'MS Sans Serif', sans-serif; background:#a0d8d0;}
#desktop { width:100vw; height:100vh; position:relative; display:none; }
#welcomeScreen { width:100vw; height:100vh; background:#f0f0f0; display:flex; justify-content:center; align-items:center; flex-direction:column; }
#welcomeScreen input, #welcomeScreen button { margin:5px; padding:5px; }
.icon { width:70px; text-align:center; cursor:pointer; font-size:20px; position:absolute; }
.icon .emoji { font-size:40px; display:block; position:relative; }
.badge {position:absolute; top:0; right:0; background:red; color:white; border-radius:50%; width:18px; height:18px; font-size:12px; display:flex; align-items:center; justify-content:center; font-weight:bold;}
.window { background:#f8f0d8; border:4px solid #a3c0b8; position:absolute; display:none; z-index:100; box-shadow:4px 4px 0 #888; resize:both; overflow:auto; transition: all 0.3s ease; }
.window#explorer { width:500px; height:400px; min-width:300px; min-height:200px; }
.window#chat { width:350px; height:400px; min-width:250px; min-height:200px; }
.window#radio { width:300px; height:450px; min-width:250px; min-height:250px; }
.window.maximized { width:100% !important; height:calc(100% - 30px) !important; top:0 !important; left:0 !important; resize:none; }
.window.opening { animation: openWindow 0.3s ease; }
.window.minimizing { animation: minimizeWindow 0.3s ease forwards; }
.window.closing { animation: closeWindow 0.3s ease forwards; }
.window-header { background:#98d6c0; padding:4px; cursor:move; display:flex; justify-content: space-between; align-items:center; }
.window-header span { font-weight:bold; }
.window-body { padding:10px; background:#fff; height:calc(100% - 30px); overflow-y:auto; }
button { cursor:pointer; }
#taskbar {position:absolute; bottom:0; left:0; width:100%; height:30px; background:#666; display:flex; align-items:center; padding:0 5px; overflow-x:auto; white-space:nowrap;}
.task-icon {width:80px; height:24px; background:#aaa; margin-right:5px; display:inline-flex; align-items:center; justify-content:center; font-size:12px; color:#000; cursor:pointer; border-radius:3px; padding:0 5px; transition:background 0.2s;}
.task-icon:hover { background:#ccc; }
.task-icon.active { background:#98d6c0; }
.card {border:1px solid #ccc; padding:5px; margin:5px 0; border-radius:4px; background:#e8f8f5;}
.card .title {font-weight:bold;}
.card .content {margin-top:3px;}
.comment-input {margin-top:5px; display:flex;}
.comment-input input {flex:1; margin-right:5px;}
#radioCover {width:100%; height:150px; background:#98d6c0; display:flex; justify-content:center; align-items:center; font-size:50px; margin-bottom:10px;}
#radioControls button {margin:5px; padding:10px; font-size:20px;}
#radioPlaylist li {cursor:pointer; margin:2px 0;}
.toast {background:#f0d888; padding:5px; margin:5px 0; border:1px solid #ccc; border-radius:3px; font-size:12px; color:#000; animation: fadeout 2s forwards;}
#clock {color:#fff; font-family:'Courier New', monospace; font-size:12px; margin-left:10px;}
@keyframes fadeout {0%{opacity:1;}90%{opacity:1;}100%{opacity:0;}}
@keyframes openWindow {from {opacity:0; transform:scale(0.9);} to {opacity:1; transform:scale(1);}}
@keyframes minimizeWindow {to {opacity:0; transform:translateY(100vh);}}
@keyframes closeWindow {to {opacity:0; transform:scale(0.9);}}
</style>
</head>
<body>

<!-- Pantalla de bienvenida -->
<div id="welcomeScreen">
  <h1>Bienvenido a Carangueju FakeNet</h1>
  <div>
    <h3>Visitante</h3>
    <input type="text" id="visitorName" placeholder="Nombre visitante">
    <button onclick="enterAsVisitor()">Entrar como visitante</button>
  </div>
  <div>
    <h3>Usuario registrado</h3>
    <input type="text" id="userName" placeholder="Usuario">
    <input type="password" id="userPass" placeholder="Contrase√±a">
    <button onclick="loginUser()">Entrar / Registrar</button>
  </div>
  <div id="welcomeToast"></div>
</div>

<!-- Escritorio -->
<div id="desktop">

  <!-- Iconos -->
  <div class="icon" style="top:20px; left:20px;" onclick="openWindow('explorer')">
    <span class="emoji">üåê</span>
    <div>Nevegou</div>
  </div>
  <div class="icon" id="chatIcon" style="top:100px; left:20px;" onclick="openWindow('chat')">
    <span class="emoji">üí¨</span>
    <div>FalaAI</div>
    <div class="badge" id="chatBadge" style="display:none;">0</div>
  </div>
  <div class="icon" style="top:180px; left:20px;" onclick="openWindow('radio')">
    <span class="emoji">üìª</span>
    <div>QuaseFM</div>
  </div>

  <!-- Barra de tareas -->
  <div id="taskbar"></div>

  <!-- Explorer -->
  <div class="window" id="explorer">
    <div class="window-header">
      <span>Navegou</span>
      <div>
        <button onclick="minimizeWindow('explorer')">_</button>
        <button onclick="toggleMaximize('explorer')">‚ñ°</button>
        <button onclick="closeWindow('explorer')">X</button>
      </div>
    </div>
    <div class="window-body" id="explorerContent">
      <div class="card">
        <div class="title">AlineBook - Publicaci√≥n 1</div>
        <div class="content">¬°Bienvenidos a Carangueju! Explora las playas y el carnaval.</div>
        <button onclick="likePost(this)">üëç</button> <span class="likes-list"></span>
        <div class="comments-list"></div>
        <div class="comment-input">
          <input type="text" placeholder="Escribe un comentario">
          <button onclick="addComment(this)">üí¨</button>
        </div>
      </div>
      <div class="card">
        <div class="title">AlineBook - Publicaci√≥n 2</div>
        <div class="content">Fotos de la fiesta de cangrejos anoche. ¬°Incre√≠ble!</div>
        <button onclick="likePost(this)">üëç</button> <span class="likes-list"></span>
        <div class="comments-list"></div>
        <div class="comment-input">
          <input type="text" placeholder="Escribe un comentario">
          <button onclick="addComment(this)">üí¨</button>
        </div>
      </div>
      <div class="card">
        <div class="title">AlineBook - Publicaci√≥n 3</div>
        <div class="content">Recetas locales de Carangueju. Prueba el ceviche de cangrejo.</div>
        <button onclick="likePost(this)">üëç</button> <span class="likes-list"></span>
        <div class="comments-list"></div>
        <div class="comment-input">
          <input type="text" placeholder="Escribe un comentario">
          <button onclick="addComment(this)">üí¨</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat -->
  <div class="window" id="chat">
    <div class="window-header">
      <span>FalaAI</span>
      <div>
        <button onclick="minimizeWindow('chat')">_</button>
        <button onclick="toggleMaximize('chat')">‚ñ°</button>
        <button onclick="closeWindow('chat')">X</button>
      </div>
    </div>
    <div class="window-body">
      <div id="chatContent"></div>
      <input type="text" id="chatInput" placeholder="Escribe un mensaje" style="width:70%;"><button onclick="sendChat()">Enviar</button>
    </div>
  </div>

  <!-- RadioCarangueju -->
  <div class="window" id="radio">
    <div class="window-header">
      <span>QuaseFM</span>
      <div>
        <button onclick="minimizeWindow('radio')">_</button>
        <button onclick="toggleMaximize('radio')">‚ñ°</button>
        <button onclick="closeWindow('radio')">X</button>
      </div>
    </div>
    <div class="window-body">
      <div id="radioCover">üéµ</div>
      <div id="radioNowPlaying">Nada a√∫n</div>
      <div id="radioControls">
        <button onclick="prevTrack()">‚èÆÔ∏è</button>
        <button onclick="togglePlay()">‚èØÔ∏è</button>
        <button onclick="nextTrack()">‚è≠Ô∏è</button>
      </div>
      <ul id="radioPlaylist"></ul>
    </div>
  </div>

</div>

<script>
let currentUser = '';
let usersDB = JSON.parse(localStorage.getItem('usersDB') || '{}');
let chatMessages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
let postsData = { 
  'post1': { likes: [], comments: [] },
  'post2': { likes: [], comments: [] },
  'post3': { likes: [], comments: [] }
};
let unreadMessages = 0;
let zIndexCounter = 100;
let windowStates = { 
  explorer: { width: 500, height: 400, left: 50, top: 50 },
  chat: { width: 350, height: 400, left: 50, top: 50 },
  radio: { width: 300, height: 450, left: 50, top: 50 }
};
let chatSimulationInterval;

const predeterminedMessages = [
  'UsuarioA: ¬°Hola desde la playa de Carangueju!',
  'UsuarioB: ¬øQui√©n se une al carnaval esta noche?',
  'UsuarioC: Recomiendo la radio, la m√∫sica est√° genial.',
  'UsuarioD: ¬øAlguien vio el atardecer ayer? Incre√≠ble!',
  'UsuarioE: Compartan recetas de cangrejo por favor.',
  'UsuarioF: ¬°Fiesta en la bah√≠a, no se la pierdan!',
  'UsuarioG: Pregunta: ¬øCu√°l es el mejor spot para surf?',
  'UsuarioH: Saludos a todos los visitantes de Carangueju.',
  'UsuarioI: La brisa del mar es lo mejor aqu√≠.',
  'UsuarioJ: ¬øIdeas para excursiones locales?'
];
let messageIndex = 0;

// --- Bienvenida ---
function showWelcomeToast(msg) {
  const container = document.getElementById('welcomeToast');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}
function enterAsVisitor() {
  const name = document.getElementById('visitorName').value.trim();
  if (!name) { showWelcomeToast('Ingresa un nombre'); return; }
  currentUser = name + ' (Visitante)';
  startDesktop();
}
function loginUser() {
  const name = document.getElementById('userName').value.trim();
  const pass = document.getElementById('userPass').value.trim();
  if (!name || !pass) { showWelcomeToast('Usuario y contrase√±a requeridos'); return; }
  if (usersDB[name]) {
    if (usersDB[name] !== pass) { showWelcomeToast('Contrase√±a incorrecta'); return; }
  } else {
    usersDB[name] = pass;
    localStorage.setItem('usersDB', JSON.stringify(usersDB));
  }
  currentUser = name;
  startDesktop();
}

// --- Cerrar sesi√≥n ---
function logout() {
  currentUser = '';
  unreadMessages = 0;
  document.getElementById('desktop').style.display = 'none';
  document.getElementById('welcomeScreen').style.display = 'flex';
  document.getElementById('taskbar').innerHTML = '';
  document.querySelectorAll('.window').forEach(w => {
    w.style.display = 'none';
    w.classList.remove('maximized', 'opening', 'minimizing', 'closing');
    windowStates[w.id] = { width: w.id === 'explorer' ? 500 : w.id === 'chat' ? 350 : 300, height: w.id === 'explorer' ? 400 : w.id === 'chat' ? 400 : 450, left: 50, top: 50 };
  });
  if (chatSimulationInterval) clearInterval(chatSimulationInterval);
}

// --- Escritorio ---
function startDesktop() {
  document.getElementById('welcomeScreen').style.display = 'none';
  document.getElementById('desktop').style.display = 'block';
  loadPosts();
  loadChat();
  loadRadio();
  initTaskbar();
  initDraggableWindows();
  startChatSimulation();
  startClock();
}

// --- Reloj ---
function startClock() {
  function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    const date = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const year = now.getFullYear();
    const clock = document.getElementById('clock');
    if (clock) {
      clock.textContent = `${hours}:${minutes}:${seconds} ${date}/${month}/${year}`;
    }
  }
  updateClock();
  setInterval(updateClock, 1000);
}

// --- Simulaci√≥n de chat ---
function isChatActive() {
  const chatWindow = document.getElementById('chat');
  if (chatWindow.style.display !== 'block') return false;
  const currentZIndex = parseInt(chatWindow.style.zIndex) || 0;
  const windows = document.querySelectorAll('.window');
  for (let win of windows) {
    if (win !== chatWindow && win.style.display === 'block') {
      const winZIndex = parseInt(win.style.zIndex) || 0;
      if (winZIndex > currentZIndex) return false;
    }
  }
  return true;
}

function startChatSimulation() {
  if (chatSimulationInterval) clearInterval(chatSimulationInterval);
  chatSimulationInterval = setInterval(() => {
    if (messageIndex < predeterminedMessages.length) {
      const msg = predeterminedMessages[messageIndex];
      chatMessages.push(msg);
      messageIndex++;
      try {
        localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
      } catch (e) {
        console.error('Error saving to localStorage:', e);
      }

      if (isChatActive()) {
        renderChat();
      } else {
        unreadMessages++;
        updateChatBadge();
      }
    } else {
      clearInterval(chatSimulationInterval);
    }
  }, 5000);
}

// --- Ventanas ---
function openWindow(id) {
  const window = document.getElementById(id);
  window.classList.remove('closing', 'minimizing');
  window.classList.add('opening');
  window.style.display = 'block';
  
  if (!window.classList.contains('maximized')) {
    window.style.width = windowStates[id].width + 'px';
    window.style.height = windowStates[id].height + 'px';
    window.style.left = windowStates[id].left + 'px';
    window.style.top = windowStates[id].top + 'px';
  }
  
  bringToFront(window);
  
  if (!document.querySelector(`.task-icon[data-window="${id}"]`)) {
    addToTaskbar(id, window.querySelector('.window-header span').textContent);
  }
  
  if (id === 'chat') {
    unreadMessages = 0;
    updateChatBadge();
    renderChat();
  }
  setTimeout(() => window.classList.remove('opening'), 300);
}

function closeWindow(id) {
  const window = document.getElementById(id);
  window.classList.add('closing');
  setTimeout(() => {
    window.style.display = 'none';
    window.classList.remove('maximized', 'closing');
    windowStates[id] = { width: id === 'explorer' ? 500 : id === 'chat' ? 350 : 300, height: id === 'explorer' ? 400 : id === 'chat' ? 400 : 450, left: 50, top: 50 };
    const taskIcon = document.querySelector(`.task-icon[data-window="${id}"]`);
    if (taskIcon) taskIcon.remove();
    if (id === 'chat' && chatSimulationInterval) {
      clearInterval(chatSimulationInterval);
      startChatSimulation();
    }
  }, 300);
}

function minimizeWindow(id) {
  const window = document.getElementById(id);
  window.classList.add('minimizing');
  setTimeout(() => {
    window.style.display = 'none';
    window.classList.remove('minimizing');
    if (!document.querySelector(`.task-icon[data-window="${id}"]`)) {
      addToTaskbar(id, window.querySelector('.window-header span').textContent);
    }
  }, 300);
}

function toggleMaximize(id) {
  const window = document.getElementById(id);
  if (window.classList.contains('maximized')) {
    window.classList.remove('maximized');
    window.style.width = windowStates[id].width + 'px';
    window.style.height = windowStates[id].height + 'px';
    window.style.left = windowStates[id].left + 'px';
    window.style.top = windowStates[id].top + 'px';
    window.style.resize = 'both';
  } else {
    windowStates[id] = {
      width: window.offsetWidth || (id === 'explorer' ? 500 : id === 'chat' ? 350 : 300),
      height: window.offsetHeight || (id === 'explorer' ? 400 : id === 'chat' ? 400 : 450),
      left: parseInt(window.style.left) || 50,
      top: parseInt(window.style.top) || 50
    };
    window.classList.add('maximized');
    window.style.resize = 'none';
  }
  bringToFront(window);
}

function bringToFront(window) {
  zIndexCounter++;
  window.style.zIndex = zIndexCounter;
  document.querySelectorAll('.task-icon').forEach(icon => icon.classList.remove('active'));
  const taskIcon = document.querySelector(`.task-icon[data-window="${window.id}"]`);
  if (taskIcon) taskIcon.classList.add('active');
  if (window.id === 'chat') {
    unreadMessages = 0;
    updateChatBadge();
    renderChat();
  }
}

// --- Barra de tareas ---
function initTaskbar() {
  const taskbar = document.getElementById('taskbar');
  taskbar.innerHTML = '';
  
  const logoutButton = document.createElement('button');
  logoutButton.textContent = 'Cerrar sesi√≥n';
  logoutButton.style.marginLeft = 'auto';
  logoutButton.style.background = '#aaa';
  logoutButton.style.color = '#000';
  logoutButton.style.border = 'none';
  logoutButton.style.padding = '5px 10px';
  logoutButton.style.cursor = 'pointer';
  logoutButton.style.borderRadius = '3px';
  logoutButton.onclick = logout;
  taskbar.appendChild(logoutButton);
  
  const userDisplay = document.createElement('div');
  userDisplay.style.marginLeft = '10px';
  userDisplay.style.color = '#fff';
  userDisplay.textContent = currentUser;
  taskbar.appendChild(userDisplay);
  
  const clock = document.createElement('div');
  clock.id = 'clock';
  taskbar.appendChild(clock);
}

function addToTaskbar(id, title) {
  const taskbar = document.getElementById('taskbar');
  const taskIcon = document.createElement('div');
  taskIcon.className = 'task-icon';
  taskIcon.textContent = title;
  taskIcon.dataset.window = id;
  taskIcon.onclick = () => {
    const window = document.getElementById(id);
    if (window.style.display === 'none') {
      openWindow(id);
    } else {
      bringToFront(window);
    }
  };
  taskbar.insertBefore(taskIcon, taskbar.firstChild);
  if (document.getElementById(id).style.display === 'block') {
    taskIcon.classList.add('active');
  }
}

// --- Arrastrar ventanas ---
function initDraggableWindows() {
  document.querySelectorAll('.window').forEach(window => {
    const header = window.querySelector('.window-header');
    let isDragging = false, currentX, currentY, initialX, initialY;

    header.addEventListener('mousedown', (e) => {
      if (window.classList.contains('maximized')) return;
      initialX = e.clientX - currentX;
      initialY = e.clientY - currentY;
      isDragging = true;
      bringToFront(window);
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        e.preventDefault();
        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;
        window.style.left = currentX + 'px';
        window.style.top = currentY + 'px';
        constrainWindowPosition(window);
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    currentX = parseInt(window.style.left) || 50;
    currentY = parseInt(window.style.top) || 50;
    window.style.left = currentX + 'px';
    window.style.top = currentY + 'px';
  });
}

function constrainWindowPosition(window) {
  if (window.classList.contains('maximized')) return;
  const desktop = document.getElementById('desktop');
  const maxX = desktop.clientWidth - window.offsetWidth;
  const maxY = desktop.clientHeight - window.offsetHeight - 30;
  let x = parseInt(window.style.left) || 0;
  let y = parseInt(window.style.top) || 0;

  x = Math.max(0, Math.min(x, maxX));
  y = Math.max(0, Math.min(y, maxY));
  window.style.left = x + 'px';
  window.style.top = y + 'px';
}

// --- Posts ---
function loadPosts() {
  document.querySelectorAll('#explorerContent .card').forEach((card, index) => {
    const postId = 'post' + (index + 1);
    renderLikes(card, postId);
    renderComments(card, postId);
  });
}

function likePost(btn) {
  if (!currentUser) { showWelcomeToast('Debes registrarte'); return; }
  const card = btn.closest('.card');
  const postId = 'post' + (Array.from(card.parentElement.children).indexOf(card) + 1);
  let likes = postsData[postId].likes;
  if (!likes.includes(currentUser)) likes.push(currentUser);
  renderLikes(card, postId);
}

function renderLikes(card, postId) {
  const span = card.querySelector('.likes-list');
  span.textContent = postsData[postId].likes.join(', ');
}

function addComment(btn) {
  if (!currentUser) { showWelcomeToast('Debes registrarte'); return; }
  const card = btn.closest('.card');
  const postId = 'post' + (Array.from(card.parentElement.children).indexOf(card) + 1);
  const input = btn.previousElementSibling;
  const text = input.value.trim();
  if (!text) return;
  postsData[postId].comments.push(currentUser + ': ' + text);
  renderComments(card, postId);
  input.value = '';
}

function renderComments(card, postId) {
  const div = card.querySelector('.comments-list');
  div.innerHTML = '';
  postsData[postId].comments.forEach(c => {
    const p = document.createElement('div');
    p.textContent = c;
    div.appendChild(p);
  });
}

// --- Chat ---
function loadChat() { renderChat(); }

function renderChat() {
  const container = document.getElementById('chatContent');
  container.innerHTML = '';
  chatMessages.forEach(m => {
    const p = document.createElement('div');
    p.textContent = m;
    if (m.startsWith(currentUser + ':')) {
      p.style.textAlign = 'right';
      p.style.background = '#e0f0ff';
      p.style.padding = '5px';
      p.style.margin = '2px';
      p.style.borderRadius = '5px';
    } else {
      p.style.padding = '5px';
      p.style.margin = '2px';
      p.style.borderRadius = '5px';
    }
    container.appendChild(p);
  });
}

function sendChat() {
  const input = document.getElementById('chatInput');
  const msg = currentUser + ': ' + input.value;
  if (!input.value.trim()) return;
  chatMessages.push(msg);
  input.value = '';
  renderChat();
  localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
}

function updateChatBadge() {
  const badge = document.getElementById('chatBadge');
  if (unreadMessages > 0) {
    badge.style.display = 'flex';
    badge.textContent = unreadMessages;
  } else {
    badge.style.display = 'none';
  }
}

// --- Radio ---
let radioPlaylist = [
  "Aline en la playa", 
  "Carnaval de Carangueju", 
  "Noche de estrellas", 
  "Fiesta de cangrejos", 
  "Brisa de la bah√≠a",
  "Olas del mar",
  "Canto de sirenas",
  "Ritmo tropical",
  "Atardecer en Carangueju",
  "Baile de cangrejos"
];
let currentTrack = 0;
let isPlaying = false;

function loadRadio() {
  const ul = document.getElementById('radioPlaylist');
  ul.innerHTML = '';
  radioPlaylist.forEach((track, index) => {
    const li = document.createElement('li');
    li.textContent = track;
    li.onclick = () => {
      currentTrack = index;
      updateRadioNowPlaying();
      if (isPlaying) togglePlay();
      togglePlay();
    };
    ul.appendChild(li);
  });
  updateRadioNowPlaying();
}

function togglePlay() {
  isPlaying = !isPlaying;
  showWelcomeToast(isPlaying ? '‚ñ∂Ô∏è Reproduciendo' : '‚è∏Ô∏è Pausado');
}

function nextTrack() {
  currentTrack = (currentTrack + 1) % radioPlaylist.length;
  updateRadioNowPlaying();
}

function prevTrack() {
  currentTrack = (currentTrack - 1 + radioPlaylist.length) % radioPlaylist.length;
  updateRadioNowPlaying();
}

function updateRadioNowPlaying() {
  document.getElementById('radioNowPlaying').textContent = 'üéµ ' + radioPlaylist[currentTrack];
}
</script>

</body>
</html>
